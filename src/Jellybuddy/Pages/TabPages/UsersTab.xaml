<?xml version="1.0" encoding="utf-8"?>

<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:Jellybuddy.ViewModels"
             xmlns:api="clr-namespace:Jellyfin.Api;assembly=Jellybuddy.Core"
             xmlns:sf="http://schemas.syncfusion.com/maui/toolkit"
             xmlns:converters="clr-namespace:Jellybuddy.Converters"
             xmlns:icons="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             xmlns:contextMenu="clr-namespace:The49.Maui.ContextMenu;assembly=The49.Maui.ContextMenu"
             xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=System.ComponentModel.TypeConverter"
             xmlns:controls="clr-namespace:Jellybuddy.Controls"
             x:Class="Jellybuddy.Pages.TabPages.UsersTab"
             x:Name="usersTab"
             x:DataType="viewModels:UsersViewModel">
    <ContentView.Content>
        <sf:SfPullToRefresh>
            <sf:SfPullToRefresh.PullableContent>
                <ScrollView Padding="10">
                    <StackLayout Orientation="Vertical">
                        <Label Text="Users" FontSize="28" FontAttributes="Bold" Margin="5" />
                        <StackLayout Orientation="Vertical">
                            <Grid ColumnDefinitions="*,5,Auto" Margin="0, 0, 0, 20">
                                <Border StrokeThickness="0" StrokeShape="RoundRectangle 10" BackgroundColor="#36343B">
                                    <Entry Margin="10, 0" ClearButtonVisibility="WhileEditing" Text="{Binding SearchText}" Placeholder="Search..." />
                                </Border>
                                <Button VerticalOptions="Start" Grid.Column="3" BackgroundColor="#36343B" BorderWidth="0" Padding="5" contextMenu:ContextMenu.ShowMenuOnClick="True">
                                    <Button.ImageSource>
                                        <FontImageSource Glyph="{icons:Material Icon={x:Static icons:MaterialIcons.Sort}}" />
                                    </Button.ImageSource>
                                    <contextMenu:ContextMenu.Menu>
                                        <DataTemplate>
                                            <contextMenu:Menu>
                                                <contextMenu:Group>
                                                    <contextMenu:Action Title="Name" Command="{Binding BindingContext.ChangeSortCategory, Source={x:Reference usersTab}}" CommandParameter="{x:Static viewModels:UserSortCategory.Name}" />
                                                    <contextMenu:Action Title="Last Active" Command="{Binding BindingContext.ChangeSortCategory, Source={x:Reference usersTab}}" CommandParameter="{x:Static viewModels:UserSortCategory.LastActive}" />
                                                    <contextMenu:Action IsVisible="False" Title="Role" Command="{Binding BindingContext.ChangeSortCategory, Source={x:Reference usersTab}}" CommandParameter="{x:Static viewModels:UserSortCategory.Role}" />
                                                </contextMenu:Group>
                                                <contextMenu:Group>
                                                    <contextMenu:Action Title="Ascending" Command="{Binding BindingContext.ChangeSortDirection, Source={x:Reference usersTab}}" CommandParameter="{x:Static componentModel:ListSortDirection.Ascending}" />
                                                    <contextMenu:Action Title="Descending" Command="{Binding BindingContext.ChangeSortDirection, Source={x:Reference usersTab}}" CommandParameter="{x:Static componentModel:ListSortDirection.Descending}" />
                                                </contextMenu:Group>
                                            </contextMenu:Menu>
                                        </DataTemplate>
                                    </contextMenu:ContextMenu.Menu>
                                </Button>
                            </Grid>
                            <CollectionView VerticalScrollBarVisibility="Never" ItemsSource="{Binding UsersViewSource.View}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="api:UserDto">
                                        <controls:UserControl BindingContext="{Binding}" />
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </StackLayout>
                </ScrollView>
            </sf:SfPullToRefresh.PullableContent>
        </sf:SfPullToRefresh>
    </ContentView.Content>
</ContentView>